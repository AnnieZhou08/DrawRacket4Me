<html>
  
</html>

<script>
  
var ProgressStage = {
  OPENBRACKET: 1, //(
  CONSTRUCTOR: 2, //MAKE
  IDENTIFIER: 3, //NODE 
  ARGUMENTS: 4, //VAL KEY LEFT RIGHT
  CLOSEBRACKET: 5 
}

function process(block, identity){
  
  var thisProcessStage = ProgressStage.OPENBRACKET;
  var constructor = "";
  var identifier = "";
  var arguments = [];
  var currentArgument = 0;
  var numOpenBrackets = 0;
  var hadSpace = false;
  
  for (var i = 0, s = block.length; i < s; i++){
    var c = block[i];
    
    switch(thisProcessStage){
      case ProgressStage.OPENBRACKET:
        if (c == " "){
          continue;
        } else if (c != "("){
          throw "Error: Bad Syntax";
        } else {
          numOpenBrackets++;
          thisProcessStage = ProgressStage.CONSTRUCTOR;
          console.log(thisProcessStage);
        }
        break;
      
      case ProgressStage.CONSTRUCTOR:
        if (c == " "){
          continue;
        } else if (constructor == "make"){
          thisProcessStage = ProgressStage.IDENTIFIER;
        } else if (constructor.length > 4){
          throw "Error: not a constructor";
        } else {
            constructor += c;
        }
        break;
      
      case ProgressStage.IDENTIFIER:
        if (c == " "){
          if (identifier == identity){
            thisProcessStage = ProgressStage.ARGUMENTS;
          } else {
            console.log(identifier);
            throw "Error: Identifier undefined";
          }
        } else if (c == ")"){
          throw "Error: Syntax / No Arguments Found";
        } else {
          identifier += c;
        }
        break;
        
      case ProgressStage.ARGUMENTS:
        if (arguments.length == currentArgument){
           arguments[currentArgument]="";
        }
        if (c == " "){
          hadSpace = true;
        } else if (c == ")"){
          numOpenBrackets--;
          if (numOpenBrackets == 0){
            break;
          } 
        } else if (c == "("){
          numOpenBrackets++;
          identifier = "";
          constructor = "";
          currentArgument++;
          thisProcessStage = ProgressStage.CONSTRUCTOR;
        } else{
          if (hadSpace == true && arguments[currentArgument].length!=0){
            arguments[currentArgument] += ","+c;
            hadSpace = false;
          } else {
            arguments[currentArgument] += c;
          }
        }
        break;          
    }
  }
  console.log(constructor);
  console.log(identifier);
  console.log(arguments);
    
}

</script>
